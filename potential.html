<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Potential Calculator</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }

        .header h1 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .stock-selector {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-top: 20px;
        }

        .stock-input {
            padding: 12px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            flex: 1;
            max-width: 300px;
        }

        .analyze-btn {
            padding: 12px 30px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .analyze-btn:hover {
            background: #5568d3;
        }

        .analyze-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .content-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .panel {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .panel h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .current-info {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .info-item {
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .info-label {
            font-size: 0.85em;
            color: #666;
            margin-bottom: 5px;
        }

        .info-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #333;
        }

        .info-value.positive {
            color: #28a745;
        }

        .info-value.negative {
            color: #dc3545;
        }

        .timeline-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .timeline-btn {
            padding: 10px 20px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }

        .timeline-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .timeline-btn:hover {
            border-color: #667eea;
        }

        .scenarios {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .scenario-card {
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .scenario-card.bullish {
            background: linear-gradient(135deg, #d4edda, #c3e6cb);
            border: 2px solid #28a745;
        }

        .scenario-card.neutral {
            background: linear-gradient(135deg, #fff3cd, #ffeeba);
            border: 2px solid #ffc107;
        }

        .scenario-card.bearish {
            background: linear-gradient(135deg, #f8d7da, #f5c6cb);
            border: 2px solid #dc3545;
        }

        .scenario-title {
            font-size: 1.1em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .scenario-price {
            font-size: 2em;
            font-weight: bold;
            margin: 10px 0;
        }

        .scenario-gain {
            font-size: 1.2em;
            font-weight: 600;
        }

        .scenario-probability {
            font-size: 0.9em;
            margin-top: 10px;
            opacity: 0.8;
        }

        .chart-container {
            position: relative;
            height: 400px;
            margin-top: 20px;
        }

        .factors-list {
            list-style: none;
            padding: 0;
        }

        .factor-item {
            padding: 12px;
            margin-bottom: 10px;
            border-radius: 8px;
            background: #f8f9fa;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .factor-name {
            font-weight: 500;
        }

        .factor-impact {
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .factor-impact.positive {
            background: #d4edda;
            color: #155724;
        }

        .factor-impact.negative {
            background: #f8d7da;
            color: #721c24;
        }

        .factor-impact.neutral {
            background: #fff3cd;
            color: #856404;
        }

        .loading {
            text-align: center;
            padding: 50px;
            color: #667eea;
            font-size: 1.2em;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid #f5c6cb;
        }

        .full-width {
            grid-column: 1 / -1;
        }

        @media (max-width: 968px) {
            .content-grid {
                grid-template-columns: 1fr;
            }
            
            .scenarios {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        function PotentialCalculator() {
            const [symbol, setSymbol] = useState('AAPL');
            const [stockData, setStockData] = useState(null);
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState(null);
            const [timeline, setTimeline] = useState('1month');
            const [potentials, setPotentials] = useState(null);
            
            const chartRef = useRef(null);
            const chartInstance = useRef(null);

            const timelines = [
                { value: '1week', label: '1 Week' },
                { value: '1month', label: '1 Month' },
                { value: '3months', label: '3 Months' },
                { value: '6months', label: '6 Months' },
                { value: '1year', label: '1 Year' }
            ];

            const analyzeStock = async () => {
                if (!symbol.trim()) return;
                
                setLoading(true);
                setError(null);
                
                try {
                    const response = await fetch(`https://stock-trading-api.onrender.com/api/stock/${symbol.toUpperCase()}?period=1y&interval=1d`);
                    if (!response.ok) {
                        throw new Error(`Failed to fetch stock data (${response.status})`);
                    }
                    
                    const data = await response.json();
                    setStockData(data);
                    calculatePotentials(data);
                } catch (err) {
                    setError(err.message);
                    console.error('Error:', err);
                } finally {
                    setLoading(false);
                }
            };

            const calculatePotentials = (data) => {
                const currentPrice = data.currentPrice;
                const indicators = data.indicators;
                const historicalData = data.historicalData;
                
                // Calculate volatility
                const returns = [];
                for (let i = 1; i < historicalData.length; i++) {
                    const ret = (historicalData[i].close - historicalData[i-1].close) / historicalData[i-1].close;
                    returns.push(ret);
                }
                const avgReturn = returns.reduce((a, b) => a + b, 0) / returns.length;
                const variance = returns.reduce((sum, ret) => sum + Math.pow(ret - avgReturn, 2), 0) / returns.length;
                const volatility = Math.sqrt(variance) * Math.sqrt(252); // Annualized

                // Calculate support and resistance levels
                const prices = historicalData.map(d => d.close);
                const high = Math.max(...prices);
                const low = Math.min(...prices);
                
                // Timeline multipliers
                const timelineMultipliers = {
                    '1week': { days: 7, mult: 0.04 },
                    '1month': { days: 30, mult: 0.15 },
                    '3months': { days: 90, mult: 0.35 },
                    '6months': { days: 180, mult: 0.55 },
                    '1year': { days: 365, mult: 1.0 }
                };

                const mult = timelineMultipliers[timeline].mult;

                // Calculate scenarios based on technical indicators
                const rsiSignal = indicators.rsi < 30 ? 1 : indicators.rsi > 70 ? -1 : 0;
                const macdSignal = indicators.macd_histogram > 0 ? 1 : -1;
                const trendSignal = currentPrice > indicators.sma_50 ? 1 : -1;
                
                // Bullish scenario: Strong upward momentum
                const bullishTarget = currentPrice * (1 + (volatility * 1.5 * mult));
                const bullishGain = ((bullishTarget - currentPrice) / currentPrice) * 100;
                const bullishProb = Math.max(20, Math.min(80, 50 + (rsiSignal + macdSignal + trendSignal) * 10));

                // Neutral scenario: Moderate movement
                const neutralTarget = currentPrice * (1 + (avgReturn * 30 * mult));
                const neutralGain = ((neutralTarget - currentPrice) / currentPrice) * 100;
                const neutralProb = 50;

                // Bearish scenario: Downward movement
                const bearishTarget = currentPrice * (1 - (volatility * 1.2 * mult));
                const bearishGain = ((bearishTarget - currentPrice) / currentPrice) * 100;
                const bearishProb = Math.max(20, Math.min(80, 50 - (rsiSignal + macdSignal + trendSignal) * 10));

                // Key factors analysis
                const factors = [
                    {
                        name: 'RSI Momentum',
                        impact: indicators.rsi < 30 ? 'Oversold - Bullish' : indicators.rsi > 70 ? 'Overbought - Bearish' : 'Neutral',
                        type: indicators.rsi < 30 ? 'positive' : indicators.rsi > 70 ? 'negative' : 'neutral'
                    },
                    {
                        name: 'MACD Trend',
                        impact: indicators.macd_histogram > 0 ? 'Bullish Crossover' : 'Bearish Momentum',
                        type: indicators.macd_histogram > 0 ? 'positive' : 'negative'
                    },
                    {
                        name: 'Moving Averages',
                        impact: currentPrice > indicators.sma_50 ? 'Above 50 SMA - Bullish' : 'Below 50 SMA - Bearish',
                        type: currentPrice > indicators.sma_50 ? 'positive' : 'negative'
                    },
                    {
                        name: 'Volatility',
                        impact: volatility > 0.4 ? 'High Risk/Reward' : volatility < 0.2 ? 'Low Volatility' : 'Moderate',
                        type: volatility > 0.4 ? 'negative' : volatility < 0.2 ? 'positive' : 'neutral'
                    },
                    {
                        name: 'Volume Trend',
                        impact: indicators.obv > 0 ? 'Accumulation' : 'Distribution',
                        type: indicators.obv > 0 ? 'positive' : 'negative'
                    }
                ];

                setPotentials({
                    bullish: { target: bullishTarget, gain: bullishGain, probability: bullishProb },
                    neutral: { target: neutralTarget, gain: neutralGain, probability: neutralProb },
                    bearish: { target: bearishTarget, gain: bearishGain, probability: bearishProb },
                    factors: factors,
                    volatility: volatility,
                    support: low,
                    resistance: high
                });
            };

            useEffect(() => {
                if (stockData) {
                    calculatePotentials(stockData);
                }
            }, [timeline]);

            useEffect(() => {
                if (chartRef.current && stockData && potentials) {
                    renderChart();
                }
            }, [stockData, potentials, timeline]);

            const renderChart = () => {
                if (chartInstance.current) {
                    chartInstance.current.destroy();
                }

                const ctx = chartRef.current.getContext('2d');
                const currentPrice = stockData.currentPrice;

                chartInstance.current = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: ['Current', `${timelines.find(t => t.value === timeline).label}`],
                        datasets: [
                            {
                                label: 'Bullish Scenario',
                                data: [currentPrice, potentials.bullish.target],
                                borderColor: '#28a745',
                                backgroundColor: 'rgba(40, 167, 69, 0.1)',
                                borderWidth: 3,
                                fill: true,
                                tension: 0.4
                            },
                            {
                                label: 'Neutral Scenario',
                                data: [currentPrice, potentials.neutral.target],
                                borderColor: '#ffc107',
                                backgroundColor: 'rgba(255, 193, 7, 0.1)',
                                borderWidth: 3,
                                fill: true,
                                tension: 0.4
                            },
                            {
                                label: 'Bearish Scenario',
                                data: [currentPrice, potentials.bearish.target],
                                borderColor: '#dc3545',
                                backgroundColor: 'rgba(220, 53, 69, 0.1)',
                                borderWidth: 3,
                                fill: true,
                                tension: 0.4
                            },
                            {
                                label: 'Support Level',
                                data: [potentials.support, potentials.support],
                                borderColor: '#17a2b8',
                                borderWidth: 2,
                                borderDash: [5, 5],
                                fill: false,
                                pointRadius: 0
                            },
                            {
                                label: 'Resistance Level',
                                data: [potentials.resistance, potentials.resistance],
                                borderColor: '#6f42c1',
                                borderWidth: 2,
                                borderDash: [5, 5],
                                fill: false,
                                pointRadius: 0
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Price Potential Scenarios',
                                font: { size: 16 }
                            },
                            legend: {
                                display: true,
                                position: 'bottom'
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return context.dataset.label + ': $' + context.parsed.y.toFixed(2);
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: false,
                                ticks: {
                                    callback: function(value) {
                                        return '$' + value.toFixed(2);
                                    }
                                }
                            }
                        }
                    }
                });
            };

            return (
                <div className="container">
                    <div className="header">
                        <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '20px'}}>
                            <div>
                                <h1>ðŸ“Š Stock & Crypto Potential Calculator</h1>
                                <p>Calculate potential price targets based on technical analysis and market conditions</p>
                            </div>
                            <div style={{display: 'flex', gap: '10px'}}>
                                <a href="index.html" style={{
                                    padding: '12px 25px',
                                    background: '#667eea',
                                    color: 'white',
                                    borderRadius: '10px',
                                    textDecoration: 'none',
                                    fontWeight: '600',
                                    fontSize: '14px'
                                }}>
                                    ðŸ“ˆ Analysis
                                </a>
                                <a href="dashboard.html" style={{
                                    padding: '12px 25px',
                                    background: '#667eea',
                                    color: 'white',
                                    borderRadius: '10px',
                                    textDecoration: 'none',
                                    fontWeight: '600',
                                    fontSize: '14px'
                                }}>
                                    ðŸŽ¯ Dashboard
                                </a>
                                <a href="daytrading.html" style={{
                                    padding: '12px 25px',
                                    background: '#4facfe',
                                    color: 'white',
                                    borderRadius: '10px',
                                    textDecoration: 'none',
                                    fontWeight: '600',
                                    fontSize: '14px'
                                }}>
                                    âš¡ Day Trading
                                </a>
                            </div>
                        </div>
                        
                        <div className="stock-selector">
                            <input
                                type="text"
                                className="stock-input"
                                placeholder="Enter symbol (e.g., AAPL, BTC-USD, ETH-USD)"
                                value={symbol}
                                onChange={(e) => setSymbol(e.target.value.toUpperCase())}
                                onKeyPress={(e) => e.key === 'Enter' && analyzeStock()}
                            />
                            <button 
                                className="analyze-btn" 
                                onClick={analyzeStock}
                                disabled={loading}
                            >
                                {loading ? 'Analyzing...' : 'Analyze'}
                            </button>
                        </div>
                        <div style={{marginTop: '15px', display: 'flex', gap: '10px', flexWrap: 'wrap'}}>
                            <button className="timeline-btn" onClick={() => setSymbol('BTC-USD')}>Bitcoin</button>
                            <button className="timeline-btn" onClick={() => setSymbol('ETH-USD')}>Ethereum</button>
                            <button className="timeline-btn" onClick={() => setSymbol('BNB-USD')}>Binance Coin</button>
                            <button className="timeline-btn" onClick={() => setSymbol('SOL-USD')}>Solana</button>
                            <button className="timeline-btn" onClick={() => setSymbol('ADA-USD')}>Cardano</button>
                            <button className="timeline-btn" onClick={() => setSymbol('XRP-USD')}>Ripple</button>
                            <button className="timeline-btn" onClick={() => setSymbol('DOGE-USD')}>Dogecoin</button>
                            <button className="timeline-btn" onClick={() => setSymbol('MATIC-USD')}>Polygon</button>
                            <button className="timeline-btn" onClick={() => setSymbol('AVAX-USD')}>Avalanche</button>
                            <button className="timeline-btn" onClick={() => setSymbol('DOT-USD')}>Polkadot</button>
                        </div>
                    </div>

                    {error && (
                        <div className="error">
                            <strong>Error:</strong> {error}
                        </div>
                    )}

                    {loading && (
                        <div className="loading">
                            Analyzing {symbol}...
                        </div>
                    )}

                    {stockData && potentials && (
                        <>
                            <div className="content-grid">
                                <div className="panel">
                                    <h2>Current Information</h2>
                                    <div className="current-info">
                                        <div className="info-item">
                                            <div className="info-label">Current Price</div>
                                            <div className="info-value">${stockData.currentPrice.toFixed(2)}</div>
                                        </div>
                                        <div className="info-item">
                                            <div className={`info-value ${stockData.change >= 0 ? 'positive' : 'negative'}`}>
                                                {stockData.change >= 0 ? 'â–²' : 'â–¼'} {stockData.changePercent.toFixed(2)}%
                                            </div>
                                            <div className="info-label">Today's Change</div>
                                        </div>
                                        <div className="info-item">
                                            <div className="info-label">Volatility (Annual)</div>
                                            <div className="info-value">{(potentials.volatility * 100).toFixed(1)}%</div>
                                        </div>
                                        <div className="info-item">
                                            <div className="info-label">RSI</div>
                                            <div className="info-value">{stockData.indicators.rsi.toFixed(1)}</div>
                                        </div>
                                    </div>

                                    <h2 style={{marginTop: '20px'}}>Select Timeline</h2>
                                    <div className="timeline-selector">
                                        {timelines.map(t => (
                                            <button
                                                key={t.value}
                                                className={`timeline-btn ${timeline === t.value ? 'active' : ''}`}
                                                onClick={() => setTimeline(t.value)}
                                            >
                                                {t.label}
                                            </button>
                                        ))}
                                    </div>
                                </div>

                                <div className="panel">
                                    <h2>Key Factors Analysis</h2>
                                    <ul className="factors-list">
                                        {potentials.factors.map((factor, idx) => (
                                            <li key={idx} className="factor-item">
                                                <span className="factor-name">{factor.name}</span>
                                                <span className={`factor-impact ${factor.type}`}>
                                                    {factor.impact}
                                                </span>
                                            </li>
                                        ))}
                                    </ul>
                                </div>

                                <div className="panel full-width">
                                    <h2>Price Scenarios for {timelines.find(t => t.value === timeline).label}</h2>
                                    <div className="scenarios">
                                        <div className="scenario-card bullish">
                                            <div className="scenario-title">ðŸš€ Bullish</div>
                                            <div className="scenario-price">
                                                ${potentials.bullish.target.toFixed(2)}
                                            </div>
                                            <div className="scenario-gain" style={{color: '#155724'}}>
                                                +{potentials.bullish.gain.toFixed(2)}%
                                            </div>
                                            <div className="scenario-probability">
                                                Probability: {potentials.bullish.probability.toFixed(0)}%
                                            </div>
                                        </div>

                                        <div className="scenario-card neutral">
                                            <div className="scenario-title">ðŸ“Š Neutral</div>
                                            <div className="scenario-price">
                                                ${potentials.neutral.target.toFixed(2)}
                                            </div>
                                            <div className="scenario-gain" style={{color: '#856404'}}>
                                                {potentials.neutral.gain >= 0 ? '+' : ''}{potentials.neutral.gain.toFixed(2)}%
                                            </div>
                                            <div className="scenario-probability">
                                                Probability: {potentials.neutral.probability.toFixed(0)}%
                                            </div>
                                        </div>

                                        <div className="scenario-card bearish">
                                            <div className="scenario-title">ðŸ“‰ Bearish</div>
                                            <div className="scenario-price">
                                                ${potentials.bearish.target.toFixed(2)}
                                            </div>
                                            <div className="scenario-gain" style={{color: '#721c24'}}>
                                                {potentials.bearish.gain.toFixed(2)}%
                                            </div>
                                            <div className="scenario-probability">
                                                Probability: {potentials.bearish.probability.toFixed(0)}%
                                            </div>
                                        </div>
                                    </div>

                                    <div className="chart-container">
                                        <canvas ref={chartRef}></canvas>
                                    </div>
                                </div>
                            </div>
                        </>
                    )}
                </div>
            );
        }

        ReactDOM.render(<PotentialCalculator />, document.getElementById('root'));
    </script>
</body>
</html>
