<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading Dashboard - Buy/Sell Signals</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .header-left h1 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header-left p {
            color: #666;
            font-size: 1.1em;
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
        }

        .nav-btn {
            padding: 12px 25px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s;
            text-decoration: none;
            display: inline-block;
        }

        .nav-btn:hover {
            background: #5568d3;
        }

        .nav-btn.secondary {
            background: #f5f5f5;
            color: #333;
        }

        .nav-btn.secondary:hover {
            background: #e0e0e0;
        }

        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .summary-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .summary-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }

        .summary-card h3 {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .summary-card .value {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
            transition: transform 0.3s ease;
        }

        .summary-card .value:hover {
            transform: scale(1.1);
        }

        .summary-card.buy .value {
            color: #28a745;
        }

        .summary-card.sell .value {
            color: #dc3545;
        }

        .summary-card.hold .value {
            color: #ffc107;
        }

        .summary-card.total .value {
            color: #667eea;
        }

        .filters {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-btn {
            padding: 10px 20px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
            font-weight: 500;
        }

        .filter-btn:hover {
            border-color: #667eea;
        }

        .filter-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .stocks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stock-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s, background-color 0.3s;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {
            0%, 100% {
                background-color: white;
            }
            50% {
                background-color: #f0f7ff;
            }
        }

        .stock-card.updating {
            animation: pulse 1s ease-in-out;
        }

        .stock-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .stock-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
        }

        .stock-card.strong-buy::before {
            background: #0056b3;
        }

        .stock-card.buy::before {
            background: #28a745;
        }

        .stock-card.hold::before {
            background: #ffc107;
        }

        .stock-card.sell::before {
            background: #fd7e14;
        }

        .stock-card.strong-sell::before {
            background: #dc3545;
        }

        .stock-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .stock-symbol {
            font-size: 1.8em;
            font-weight: bold;
            color: #333;
        }

        .stock-name {
            color: #666;
            font-size: 0.9em;
            margin-top: 5px;
        }

        .recommendation-badge {
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.85em;
            text-transform: uppercase;
            transition: all 0.3s ease;
        }

        .badge-strong-buy {
            background: #d1ecf1;
            color: #0056b3;
        }

        .badge-buy {
            background: #d4edda;
            color: #155724;
        }

        .badge-hold {
            background: #fff3cd;
            color: #856404;
        }

        .badge-sell {
            background: #ffe5d0;
            color: #8b4513;
        }

        .badge-strong-sell {
            background: #f8d7da;
            color: #721c24;
        }

        .stock-price {
            font-size: 2em;
            font-weight: bold;
            color: #333;
            margin: 10px 0;
            transition: all 0.3s ease;
        }

        .stock-price.price-up {
            animation: priceUp 0.6s ease;
        }

        .stock-price.price-down {
            animation: priceDown 0.6s ease;
        }

        @keyframes priceUp {
            0%, 100% { color: #333; }
            50% { color: #28a745; transform: scale(1.05); }
        }

        @keyframes priceDown {
            0%, 100% { color: #333; }
            50% { color: #dc3545; transform: scale(1.05); }
        }

        .stock-change {
            font-size: 1.1em;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .stock-change.positive {
            color: #28a745;
        }

        .stock-change.negative {
            color: #dc3545;
        }

        .confidence-bar {
            margin-top: 15px;
        }

        .confidence-label {
            display: flex;
            justify-content: space-between;
            font-size: 0.85em;
            color: #666;
            margin-bottom: 5px;
        }

        .confidence-progress {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
        }

        .confidence-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s;
        }

        .confidence-high {
            background: linear-gradient(90deg, #28a745, #20c997);
        }

        .confidence-medium {
            background: linear-gradient(90deg, #ffc107, #fd7e14);
        }

        .confidence-low {
            background: linear-gradient(90deg, #dc3545, #c82333);
        }

        .signals-summary {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #e0e0e0;
        }

        .signal-item {
            font-size: 0.85em;
            color: #666;
            margin: 5px 0;
            display: flex;
            align-items: center;
        }

        .signal-item::before {
            content: "‚Ä¢";
            margin-right: 8px;
            font-weight: bold;
        }

        .signal-item.bullish::before {
            color: #28a745;
        }

        .signal-item.bearish::before {
            color: #dc3545;
        }

        .loading {
            text-align: center;
            padding: 50px;
            font-size: 1.5em;
            color: white;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid #f5c6cb;
        }

        .refresh-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            transition: all 0.3s;
        }

        .refresh-btn:hover {
            background: #5568d3;
            transform: rotate(180deg);
        }

        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
            border-radius: 4px;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .progress-bar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: #e0e0e0;
            z-index: 1000;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.3s ease;
        }

        @media (max-width: 768px) {
            .stocks-grid {
                grid-template-columns: 1fr;
            }
            
            .header {
                flex-direction: column;
                gap: 20px;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        function Dashboard() {
            console.log('Dashboard component loaded!');
            
            const [stocks, setStocks] = useState([]);
            const [pennyStocks, setPennyStocks] = useState([]);
            const [cryptoStocks, setCryptoStocks] = useState([]);
            const [loading, setLoading] = useState(true);
            const [loadingProgress, setLoadingProgress] = useState({ current: 0, total: 0, symbol: '' });
            const [error, setError] = useState(null);
            const [filter, setFilter] = useState('all');
            const [pennyFilter, setPennyFilter] = useState('all');
            const [cryptoFilter, setCryptoFilter] = useState('all');
            const [lastUpdate, setLastUpdate] = useState(new Date());
            const [autoRefresh, setAutoRefresh] = useState(false); // Disabled by default to avoid rate limiting
            const [refreshInterval, setRefreshInterval] = useState(300); // 5 minutes instead of 30 seconds
            const [customSymbol, setCustomSymbol] = useState('');
            const [customPennySymbol, setCustomPennySymbol] = useState('');
            const [customCryptoSymbol, setCustomCryptoSymbol] = useState('');
            // Regular stocks watchlist - S&P 500
            const [watchlist, setWatchlist] = useState(() => {
                // Migration: Clear old combined watchlist if it exists and is too large
                const oldSaved = localStorage.getItem('stockWatchlist');
                if (oldSaved) {
                    const oldList = JSON.parse(oldSaved);
                    // If old list has more than 400 stocks, it's the old combined list - clear it
                    if (oldList.length > 400) {
                        localStorage.removeItem('stockWatchlist');
                        localStorage.removeItem('pennyStockWatchlist');
                    }
                }
                
                const saved = localStorage.getItem('stockWatchlist');
                return saved ? JSON.parse(saved) : [
                    // S&P 500 - Complete List
                    'AAPL', 'MSFT', 'GOOGL', 'GOOG', 'AMZN', 'NVDA', 'META', 'TSLA', 'BRK.B', 'LLY',
                    'V', 'UNH', 'XOM', 'JPM', 'JNJ', 'WMT', 'MA', 'PG', 'AVGO', 'HD',
                    'CVX', 'ABBV', 'MRK', 'COST', 'ORCL', 'KO', 'PEP', 'ADBE', 'BAC', 'CRM',
                    'NFLX', 'AMD', 'TMO', 'ACN', 'MCD', 'CSCO', 'LIN', 'ABT', 'DIS', 'WFC',
                    'VZ', 'CMCSA', 'INTC', 'TXN', 'DHR', 'PM', 'NEE', 'INTU', 'UPS', 'AMGN',
                    'RTX', 'QCOM', 'HON', 'IBM', 'SPGI', 'LOW', 'AMAT', 'CAT', 'GE', 'BA',
                    'NKE', 'UNP', 'AXP', 'ELV', 'SBUX', 'DE', 'BLK', 'LMT', 'MS', 'GS',
                    'PLD', 'TJX', 'BKNG', 'SYK', 'GILD', 'ADI', 'MMC', 'MDLZ', 'ADP', 'VRTX',
                    'C', 'AMT', 'CI', 'ISRG', 'CB', 'CVS', 'REGN', 'SO', 'ZTS', 'PGR',
                    'NOW', 'LRCX', 'DUK', 'BDX', 'TGT', 'SCHW', 'BMY', 'MO', 'BSX', 'ETN',
                    'PNC', 'MMM', 'FI', 'SLB', 'EQIX', 'AON', 'ITW', 'EOG', 'APD', 'HCA',
                    'CL', 'MU', 'WM', 'USB', 'ICE', 'NSC', 'MCK', 'GD', 'COP', 'MAR',
                    'EMR', 'NOC', 'EW', 'PYPL', 'PSX', 'APH', 'SHW', 'CME', 'DG', 'KLAC',
                    'FCX', 'TT', 'ECL', 'ORLY', 'TFC', 'ROP', 'CARR', 'MSI', 'SPG', 'AJG',
                    'MCO', 'AFL', 'BK', 'SNPS', 'GM', 'AZO', 'AEP', 'PSA', 'JCI', 'SRE',
                    'MPC', 'CSX', 'FDX', 'PCAR', 'CDNS', 'ADSK', 'O', 'TRV', 'COF', 'NXPI',
                    'HUM', 'CCI', 'PAYX', 'ALL', 'AIG', 'ROST', 'MSCI', 'D', 'EXC', 'PH',
                    'MCHP', 'WELL', 'TEL', 'KMB', 'FTNT', 'CMG', 'AMP', 'RSG', 'PRU', 'HSY',
                    'F', 'GWW', 'XEL', 'CTAS', 'FAST', 'DLR', 'CPRT', 'AME', 'HLT', 'KMI',
                    'CTVA', 'PCG', 'ADM', 'IDXX', 'KHC', 'ODFL', 'TROW', 'LHX', 'OTIS', 'DHI',
                    'YUM', 'CEG', 'VRSK', 'EA', 'WMB', 'KVUE', 'DD', 'IQV', 'EXR', 'IT',
                    'SYY', 'GEHC', 'RMD', 'ACGL', 'GLW', 'MTD', 'HWM', 'KR', 'URI', 'IR',
                    'HPQ', 'ANSS', 'GIS', 'A', 'ED', 'OKE', 'VICI', 'WAB', 'DAL', 'EFX',
                    'LULU', 'ROK', 'CTSH', 'PPG', 'XYL', 'EBAY', 'CBRE', 'TSCO', 'RJF', 'ON',
                    'MNST', 'VMC', 'DOV', 'FANG', 'MLM', 'NDAQ', 'EIX', 'MPWR', 'WEC', 'KEYS',
                    'CDW', 'CBOE', 'AVB', 'BRO', 'FITB', 'STZ', 'ETR', 'IFF', 'CHD', 'TSN',
                    'HPE', 'DFS', 'AEE', 'VTR', 'TTWO', 'WTW', 'FTV', 'AXON', 'HUBB', 'ALGN',
                    'MTB', 'CLX', 'AWK', 'CSGP', 'LYB', 'CAH', 'MKC', 'CNP', 'STE', 'FE',
                    'HBAN', 'TDG', 'WST', 'EQR', 'PPL', 'DTE', 'BR', 'TYL', 'BALL', 'IRM',
                    'ULTA', 'TDY', 'ZBRA', 'INVH', 'HOLX', 'VLTO', 'PTC', 'NTRS', 'PKI', 'LH',
                    'STLD', 'ATO', 'APTV', 'DRI', 'CFG', 'LUV', 'MAA', 'LDOS', 'EXPD', 'EXPE',
                    'TRMB', 'RF', 'AMCR', 'SYF', 'MOS', 'GPN', 'BLDR', 'ARE', 'OMC', 'VRSN',
                    'BAX', 'CINF', 'NVR', 'ESS', 'AVY', 'LVS', 'PODD', 'WRB', 'DGX', 'K',
                    'NUE', 'DECK', 'NTAP', 'POOL', 'J', 'IEX', 'HBAN', 'UDR', 'WY', 'SWK',
                    'TRGP', 'UAL', 'CAG', 'CTLT', 'JBHT', 'HST', 'DOC', 'CPT', 'CE', 'CRL',
                    'FDS', 'IP', 'WDC', 'JKHY', 'COO', 'LKQ', 'SNA', 'PKG', 'EMN', 'EPAM',
                    'MRO', 'PAYC', 'TECH', 'KIM', 'AKAM', 'TPR', 'PFG', 'AOS', 'BG', 'CHRW',
                    'BBY', 'WAT', 'REG', 'SWKS', 'ETSY', 'FICO', 'INCY', 'HSIC', 'IPG', 'NDSN',
                    'BXP', 'TAP', 'ALLE', 'HII', 'MKTX', 'FFIV', 'UHS', 'CPB', 'HRL', 'EVRG',
                    'GL', 'ENPH', 'APA', 'ALB', 'TER', 'AAL', 'AIZ', 'GNRC', 'LW', 'MOH',
                    'PNR', 'MTCH', 'RHI', 'BWA', 'WYNN', 'BEN', 'HAS', 'NI', 'RL', 'FOXA',
                    'WHR', 'CZR', 'JNPR', 'PARA', 'NWS', 'NWSA', 'FOX', 'ZION', 'DVN', 'IVZ'
                ];
            });

            // Penny stocks watchlist - High volatility, high upswing potential
            const [pennyWatchlist, setPennyWatchlist] = useState(() => {
                const saved = localStorage.getItem('pennyStockWatchlist');
                return saved ? JSON.parse(saved) : [
                    // Meme Stocks / High Volatility
                    'GME', 'AMC', 'BB', 'NOK', 'BBBY', 'CLOV', 'WISH', 'EXPR', 'KOSS',
                    // Penny Stocks - High Potential (< $10)
                    'SIRI', 'SOFI', 'HOOD', 'OPEN', 'PINS', 'DKNG', 'SKLZ', 'RDFN',
                    'PTON', 'FUBO', 'SONO', 'BLNK', 'WKHS', 'RIDE', 'FSR', 'GOEV',
                    // Biotech Penny Stocks - High Upswing
                    'SAVA', 'OCGN', 'PROG', 'ATOS', 'JAGX', 'CIDM', 'INPX', 'BNGO',
                    'CLVS', 'OBSV', 'MNKD', 'VXRT', 'NVAX', 'CODX', 'NERV',
                    // Clean Energy / Green Tech Penny Stocks
                    'PLUG', 'FCEL', 'CLSK', 'GEVO', 'EOSE', 'ARVL', 'MULN', 'ELMS', 
                    'AYRO', 'SOLO',
                    // Crypto-Related Penny Stocks
                    'RIOT', 'MARA', 'HUT', 'BITF', 'BTBT', 'CAN', 'ARBK',
                    // SPACs and High Risk
                    'SPCE', 'CCIV', 'DWAC', 'PHUN', 'CFVI', 'IRNT', 'OPAD',
                    // Small Cap Tech - High Growth Potential
                    'UPST', 'AFRM', 'BROS', 'RKLB', 'IONQ', 'DOCS', 'PATH', 'BILL',
                    'S', 'CFLT', 'GTLB', 'NCNO', 'ASAN', 'MNDY', 'FROG',
                    // Cannabis Stocks
                    'TLRY', 'SNDL', 'CGC', 'ACB', 'CRON', 'HEXO', 'OGI', 'CURLF',
                    // Microcap - Ultra High Risk/Reward
                    'MMAT', 'TRCH', 'NAKD', 'CTRM', 'SHIP', 'GNUS'
                ];
            });

            // Cryptocurrency watchlist - Major cryptos and altcoins
            const [cryptoWatchlist, setCryptoWatchlist] = useState(() => {
                const saved = localStorage.getItem('cryptoWatchlist');
                return saved ? JSON.parse(saved) : [
                    // Major Cryptocurrencies
                    'BTC-USD', 'ETH-USD', 'BNB-USD', 'XRP-USD', 'ADA-USD',
                    // Top Altcoins
                    'SOL-USD', 'DOGE-USD', 'MATIC-USD', 'DOT-USD', 'AVAX-USD',
                    'SHIB-USD', 'LTC-USD', 'TRX-USD', 'LINK-USD', 'UNI-USD',
                    'ATOM-USD', 'XLM-USD', 'BCH-USD', 'ALGO-USD', 'VET-USD',
                    // DeFi Tokens
                    'AAVE-USD', 'MKR-USD', 'COMP-USD', 'SNX-USD', 'CRV-USD',
                    // Layer 2 / Scaling
                    'ARB-USD', 'OP-USD', 'IMX-USD',
                    // Meme Coins
                    'PEPE-USD', 'FLOKI-USD',
                    // Gaming / Metaverse
                    'SAND-USD', 'MANA-USD', 'AXS-USD', 'ENJ-USD',
                    // Stablecoins (for reference)
                    'USDT-USD', 'USDC-USD'
                ];
            });

            const fetchAllStocks = async () => {
                const isInitialLoad = stocks.length === 0 && pennyStocks.length === 0 && cryptoStocks.length === 0;
                if (isInitialLoad) setLoading(true);
                setError(null);
                const regularStocksData = [...stocks];
                const pennyStocksData = [...pennyStocks];
                const cryptoStocksData = [...cryptoStocks];

                const totalStocks = watchlist.length + pennyWatchlist.length + cryptoWatchlist.length;
                let currentIndex = 0;

                console.log('Starting to fetch stocks and crypto...', { 
                    regularCount: watchlist.length, 
                    pennyCount: pennyWatchlist.length,
                    cryptoCount: cryptoWatchlist.length,
                    total: totalStocks 
                });

                // Helper function to add delay
                const delay = (ms) => new Promise(resolve => setTimeout(resolve, ms));

                // Fetch regular stocks with delay to avoid rate limiting
                for (let i = 0; i < watchlist.length; i++) {
                    const symbol = watchlist[i];
                    currentIndex++;
                    setLoadingProgress({ current: currentIndex, total: totalStocks, symbol });
                    
                    try {
                        console.log(`Fetching regular stock: ${symbol}`);
                        const response = await fetch(`https://stock-trading-api.onrender.com/api/stock/${symbol}?period=1mo&interval=1d`);
                        console.log(`Response for ${symbol}:`, response.status);
                        
                        if (response.ok) {
                            const data = await response.json();
                            
                            // Check for rate limit error
                            if (data.error && data.error.includes('Rate limited')) {
                                console.warn('Rate limited! Waiting 60 seconds...');
                                setError('Yahoo Finance rate limit reached. Waiting 60 seconds before continuing...');
                                await delay(60000);
                                i--; // Retry this symbol
                                continue;
                            }
                            
                            const newStock = {
                                symbol: data.symbol,
                                name: data.name,
                                price: data.currentPrice,
                                change: data.change,
                                changePercent: data.changePercent,
                                recommendation: data.recommendation
                            };
                            
                            const existingIndex = regularStocksData.findIndex(s => s.symbol === symbol);
                            if (existingIndex >= 0) {
                                regularStocksData[existingIndex] = newStock;
                            } else {
                                regularStocksData.push(newStock);
                            }
                            
                            setStocks([...regularStocksData]);
                            setError(null);
                        } else {
                            console.error(`Failed to fetch ${symbol}: ${response.status}`);
                        }
                        
                        // Add delay between requests to avoid rate limiting (2 seconds)
                        await delay(2000);
                        
                    } catch (err) {
                        console.error(`Error fetching ${symbol}:`, err);
                        setError(`Failed to connect to API. Make sure Flask server is running on port 5000.`);
                    }
                }

                // Fetch penny stocks with delay
                for (let i = 0; i < pennyWatchlist.length; i++) {
                    const symbol = pennyWatchlist[i];
                    currentIndex++;
                    setLoadingProgress({ current: currentIndex, total: totalStocks, symbol });
                    
                    try {
                        console.log(`Fetching penny stock: ${symbol}`);
                        const response = await fetch(`https://stock-trading-api.onrender.com/api/stock/${symbol}?period=1mo&interval=1d`);
                        console.log(`Response for ${symbol}:`, response.status);
                        
                        if (response.ok) {
                            const data = await response.json();
                            
                            // Check for rate limit error
                            if (data.error && data.error.includes('Rate limited')) {
                                console.warn('Rate limited! Waiting 60 seconds...');
                                setError('Yahoo Finance rate limit reached. Waiting 60 seconds before continuing...');
                                await delay(60000);
                                i--; // Retry this symbol
                                continue;
                            }
                            
                            const newStock = {
                                symbol: data.symbol,
                                name: data.name,
                                price: data.currentPrice,
                                change: data.change,
                                changePercent: data.changePercent,
                                recommendation: data.recommendation
                            };
                            
                            const existingIndex = pennyStocksData.findIndex(s => s.symbol === symbol);
                            if (existingIndex >= 0) {
                                pennyStocksData[existingIndex] = newStock;
                            } else {
                                pennyStocksData.push(newStock);
                            }
                            
                            setPennyStocks([...pennyStocksData]);
                            setError(null);
                        } else {
                            console.error(`Failed to fetch penny stock ${symbol}: ${response.status}`);
                        }
                        
                        // Add delay between requests (2 seconds)
                        await delay(2000);
                        
                    } catch (err) {
                        console.error(`Error fetching penny stock ${symbol}:`, err);
                    }
                }

                // Fetch crypto with delay
                for (let i = 0; i < cryptoWatchlist.length; i++) {
                    const symbol = cryptoWatchlist[i];
                    currentIndex++;
                    setLoadingProgress({ current: currentIndex, total: totalStocks, symbol });
                    
                    try {
                        console.log(`Fetching crypto: ${symbol}`);
                        const response = await fetch(`https://stock-trading-api.onrender.com/api/stock/${symbol}?period=1mo&interval=1d`);
                        console.log(`Response for ${symbol}:`, response.status);
                        
                        if (response.ok) {
                            const data = await response.json();
                            
                            // Check for rate limit error
                            if (data.error && data.error.includes('Rate limited')) {
                                console.warn('Rate limited! Waiting 60 seconds...');
                                setError('Yahoo Finance rate limit reached. Waiting 60 seconds before continuing...');
                                await delay(60000);
                                i--;
                                continue;
                            }
                            
                            const newStock = {
                                symbol: data.symbol,
                                name: data.name,
                                price: data.currentPrice,
                                change: data.change,
                                changePercent: data.changePercent,
                                recommendation: data.recommendation
                            };
                            
                            const existingIndex = cryptoStocksData.findIndex(s => s.symbol === symbol);
                            if (existingIndex >= 0) {
                                cryptoStocksData[existingIndex] = newStock;
                            } else {
                                cryptoStocksData.push(newStock);
                            }
                            
                            setCryptoStocks([...cryptoStocksData]);
                            setError(null);
                        } else {
                            console.error(`Failed to fetch crypto ${symbol}: ${response.status}`);
                        }
                        
                        // Add delay between requests (2 seconds)
                        await delay(2000);
                        
                    } catch (err) {
                        console.error(`Error fetching crypto ${symbol}:`, err);
                    }
                }

                setLoading(false);
                setLastUpdate(new Date());
                console.log('Finished fetching all assets', { 
                    regularStocks: regularStocksData.length, 
                    pennyStocks: pennyStocksData.length,
                    crypto: cryptoStocksData.length 
                });
            };

            useEffect(() => {
                fetchAllStocks();
                
                // Set up auto-refresh
                if (autoRefresh) {
                    const interval = setInterval(() => {
                        fetchAllStocks();
                    }, refreshInterval * 1000);
                    
                    return () => clearInterval(interval);
                }
            }, [autoRefresh, refreshInterval, watchlist.length, pennyWatchlist.length, cryptoWatchlist.length]);

            const getFilteredStocks = () => {
                if (filter === 'all') return stocks;
                return stocks.filter(stock => {
                    const action = stock.recommendation?.type || 'HOLD';
                    if (filter === 'buy') return action === 'BUY' || action === 'STRONG_BUY';
                    if (filter === 'sell') return action === 'SELL' || action === 'STRONG_SELL';
                    if (filter === 'hold') return action === 'HOLD';
                    return true;
                });
            };

            const getFilteredPennyStocks = () => {
                if (pennyFilter === 'all') return pennyStocks;
                return pennyStocks.filter(stock => {
                    const action = stock.recommendation?.type || 'HOLD';
                    if (pennyFilter === 'buy') return action === 'BUY' || action === 'STRONG_BUY';
                    if (pennyFilter === 'sell') return action === 'SELL' || action === 'STRONG_SELL';
                    if (pennyFilter === 'hold') return action === 'HOLD';
                    return true;
                });
            };

            const getFilteredCryptoStocks = () => {
                if (cryptoFilter === 'all') return cryptoStocks;
                return cryptoStocks.filter(stock => {
                    const action = stock.recommendation?.type || 'HOLD';
                    if (cryptoFilter === 'buy') return action === 'BUY' || action === 'STRONG_BUY';
                    if (cryptoFilter === 'sell') return action === 'SELL' || action === 'STRONG_SELL';
                    if (cryptoFilter === 'hold') return action === 'HOLD';
                    return true;
                });
            };

            const getSummary = () => {
                const summary = {
                    total: stocks.length,
                    strongBuy: 0,
                    buy: 0,
                    hold: 0,
                    sell: 0,
                    strongSell: 0
                };

                stocks.forEach(stock => {
                    const action = stock.recommendation?.type || 'HOLD';
                    if (action === 'STRONG_BUY') summary.strongBuy++;
                    else if (action === 'BUY') summary.buy++;
                    else if (action === 'SELL') summary.sell++;
                    else if (action === 'STRONG_SELL') summary.strongSell++;
                    else summary.hold++;
                });

                return summary;
            };

            const getPennySummary = () => {
                const summary = {
                    total: pennyStocks.length,
                    strongBuy: 0,
                    buy: 0,
                    hold: 0,
                    sell: 0,
                    strongSell: 0
                };

                pennyStocks.forEach(stock => {
                    const action = stock.recommendation?.type || 'HOLD';
                    if (action === 'STRONG_BUY') summary.strongBuy++;
                    else if (action === 'BUY') summary.buy++;
                    else if (action === 'SELL') summary.sell++;
                    else if (action === 'STRONG_SELL') summary.strongSell++;
                    else summary.hold++;
                });

                return summary;
            };

            const getCryptoSummary = () => {
                const summary = {
                    total: cryptoStocks.length,
                    strongBuy: 0,
                    buy: 0,
                    hold: 0,
                    sell: 0,
                    strongSell: 0
                };

                cryptoStocks.forEach(stock => {
                    const action = stock.recommendation?.type || 'HOLD';
                    if (action === 'STRONG_BUY') summary.strongBuy++;
                    else if (action === 'BUY') summary.buy++;
                    else if (action === 'SELL') summary.sell++;
                    else if (action === 'STRONG_SELL') summary.strongSell++;
                    else summary.hold++;
                });

                return summary;
            };

            const getRecommendationClass = (type) => {
                return type?.toLowerCase().replace('_', '-') || 'hold';
            };

            const getConfidenceClass = (confidence) => {
                if (confidence >= 70) return 'confidence-high';
                if (confidence >= 50) return 'confidence-medium';
                return 'confidence-low';
            };

            const handleStockClick = (symbol) => {
                window.open(`index.html?symbol=${symbol}`, '_blank');
            };

            const addStock = (e) => {
                e.preventDefault();
                if (customSymbol.trim() && !watchlist.includes(customSymbol.toUpperCase())) {
                    const newWatchlist = [...watchlist, customSymbol.toUpperCase()];
                    setWatchlist(newWatchlist);
                    localStorage.setItem('stockWatchlist', JSON.stringify(newWatchlist));
                    setCustomSymbol('');
                }
            };

            const addPennyStock = (e) => {
                e.preventDefault();
                if (customPennySymbol.trim() && !pennyWatchlist.includes(customPennySymbol.toUpperCase())) {
                    const newWatchlist = [...pennyWatchlist, customPennySymbol.toUpperCase()];
                    setPennyWatchlist(newWatchlist);
                    localStorage.setItem('pennyStockWatchlist', JSON.stringify(newWatchlist));
                    setCustomPennySymbol('');
                }
            };

            const removeStock = (symbol) => {
                const newWatchlist = watchlist.filter(s => s !== symbol);
                setWatchlist(newWatchlist);
                localStorage.setItem('stockWatchlist', JSON.stringify(newWatchlist));
                setStocks(stocks.filter(s => s.symbol !== symbol));
            };

            const removePennyStock = (symbol) => {
                const newWatchlist = pennyWatchlist.filter(s => s !== symbol);
                setPennyWatchlist(newWatchlist);
                localStorage.setItem('pennyStockWatchlist', JSON.stringify(newWatchlist));
                setPennyStocks(pennyStocks.filter(s => s.symbol !== symbol));
            };

            const addCrypto = (e) => {
                e.preventDefault();
                if (customCryptoSymbol.trim() && !cryptoWatchlist.includes(customCryptoSymbol.toUpperCase())) {
                    const newWatchlist = [...cryptoWatchlist, customCryptoSymbol.toUpperCase()];
                    setCryptoWatchlist(newWatchlist);
                    localStorage.setItem('cryptoWatchlist', JSON.stringify(newWatchlist));
                    setCustomCryptoSymbol('');
                }
            };

            const removeCrypto = (symbol) => {
                const newWatchlist = cryptoWatchlist.filter(s => s !== symbol);
                setCryptoWatchlist(newWatchlist);
                localStorage.setItem('cryptoWatchlist', JSON.stringify(newWatchlist));
                setCryptoStocks(cryptoStocks.filter(s => s.symbol !== symbol));
            };

            const resetToDefaults = () => {
                const defaultList = [
                    'AAPL', 'MSFT', 'GOOGL', 'AMZN', 'NVDA', 'TSLA', 'META', 'NFLX',
                    'AMD', 'INTC', 'BABA', 'DIS', 'PYPL', 'SHOP', 'SQ', 'ROKU',
                    'COIN', 'PLTR', 'SNOW', 'U', 'NET', 'DDOG', 'CRWD', 'ZM'
                ];
                setWatchlist(defaultList);
                localStorage.setItem('stockWatchlist', JSON.stringify(defaultList));
            };

            const filteredStocks = getFilteredStocks();
            const filteredPennyStocks = getFilteredPennyStocks();
            const filteredCryptoStocks = getFilteredCryptoStocks();
            const summary = getSummary();
            const pennySummary = getPennySummary();
            const cryptoSummary = getCryptoSummary();

            return (
                <div className="container">
                    {loading && (
                        <div className="progress-bar">
                            <div 
                                className="progress-fill" 
                                style={{width: `${(loadingProgress.current / loadingProgress.total) * 100}%`}}
                            ></div>
                        </div>
                    )}
                    
                    <div className="header">
                        <div className="header-left">
                            <h1>üéØ Trading Dashboard</h1>
                            <p>Real-time buy/sell recommendations powered by AI</p>
                            <small style={{color: '#999', marginTop: '5px', display: 'block'}}>
                                Tracking {watchlist.length} regular stocks + {pennyWatchlist.length} penny stocks ‚Ä¢ Last updated: {lastUpdate.toLocaleTimeString()}
                                {autoRefresh && ` ‚Ä¢ Auto-refresh every ${refreshInterval}s`}
                            </small>
                            {loading && (
                                <div style={{marginTop: '10px', color: '#667eea', fontWeight: 'bold'}}>
                                    Loading {loadingProgress.symbol}... ({loadingProgress.current}/{loadingProgress.total})
                                </div>
                            )}
                        </div>
                        <div className="nav-buttons">
                            <button 
                                className={`nav-btn ${autoRefresh ? '' : 'secondary'}`}
                                onClick={() => setAutoRefresh(!autoRefresh)}
                                style={{marginRight: '10px'}}
                            >
                                {autoRefresh ? '‚è∏Ô∏è Pause' : '‚ñ∂Ô∏è Resume'} Auto-Refresh
                            </button>
                            <a href="index.html" className="nav-btn secondary">Detailed Analysis</a>
                            <a href="potential.html" className="nav-btn">üìä Price Potential</a>
                            <a href="daytrading.html" className="nav-btn">‚ö° Day Trading</a>
                        </div>
                    </div>

                    {/* Regular Stocks Section */}
                    <div style={{marginBottom: '50px'}}>
                        <h2 style={{color: 'white', marginBottom: '20px', fontSize: '2em', display: 'flex', alignItems: 'center', gap: '10px'}}>
                            üìä Regular Stocks
                            <span style={{fontSize: '0.5em', background: 'rgba(255,255,255,0.2)', padding: '5px 15px', borderRadius: '20px'}}>
                                {watchlist.length} stocks
                            </span>
                        </h2>

                        <div className="summary-cards">
                            <div className="summary-card total">
                                <h3>Total Stocks</h3>
                                <div className="value">{summary.total}</div>
                            </div>
                            <div className="summary-card buy">
                                <h3>Buy Signals</h3>
                                <div className="value">{summary.strongBuy + summary.buy}</div>
                                <small>Strong: {summary.strongBuy} | Buy: {summary.buy}</small>
                            </div>
                            <div className="summary-card hold">
                                <h3>Hold Signals</h3>
                                <div className="value">{summary.hold}</div>
                            </div>
                            <div className="summary-card sell">
                                <h3>Sell Signals</h3>
                                <div className="value">{summary.strongSell + summary.sell}</div>
                                <small>Strong: {summary.strongSell} | Sell: {summary.sell}</small>
                            </div>
                        </div>

                        <div className="filters">
                            <strong>Filter:</strong>
                            <button 
                                className={`filter-btn ${filter === 'all' ? 'active' : ''}`}
                                onClick={() => setFilter('all')}
                            >
                                All ({stocks.length})
                            </button>
                            <button 
                                className={`filter-btn ${filter === 'buy' ? 'active' : ''}`}
                                onClick={() => setFilter('buy')}
                            >
                                Buy ({summary.strongBuy + summary.buy})
                            </button>
                            <button 
                                className={`filter-btn ${filter === 'hold' ? 'active' : ''}`}
                                onClick={() => setFilter('hold')}
                            >
                                Hold ({summary.hold})
                            </button>
                            <button 
                                className={`filter-btn ${filter === 'sell' ? 'active' : ''}`}
                                onClick={() => setFilter('sell')}
                            >
                                Sell ({summary.strongSell + summary.sell})
                            </button>
                            
                            <div style={{marginLeft: 'auto', display: 'flex', gap: '10px', alignItems: 'center'}}>
                                <form onSubmit={addStock} style={{display: 'flex', gap: '10px'}}>
                                    <input
                                        type="text"
                                        placeholder="Add stock symbol (e.g., AAPL)"
                                        value={customSymbol}
                                        onChange={(e) => setCustomSymbol(e.target.value.toUpperCase())}
                                        style={{
                                            padding: '10px 15px',
                                            border: '2px solid #e0e0e0',
                                            borderRadius: '25px',
                                            fontSize: '14px',
                                            minWidth: '200px'
                                        }}
                                    />
                                    <button
                                        type="submit"
                                        className="filter-btn"
                                        style={{background: '#28a745', color: 'white', border: 'none'}}
                                    >
                                        + Add Stock
                                    </button>
                                </form>
                            </div>
                        </div>

                        {error && (
                            <div className="error">
                                <strong>Error:</strong> {error}
                            </div>
                        )}

                        <div className="stocks-grid">
                            {filteredStocks.map(stock => (
                                <div 
                                    key={stock.symbol} 
                                    className={`stock-card ${getRecommendationClass(stock.recommendation?.type)} ${loading ? 'updating' : ''}`}
                                    onClick={() => handleStockClick(stock.symbol)}
                                    style={{
                                        animationDelay: `${filteredStocks.indexOf(stock) * 0.05}s`
                                    }}
                                >
                                    <button
                                        onClick={(e) => {
                                            e.stopPropagation();
                                            removeStock(stock.symbol);
                                        }}
                                        style={{
                                            position: 'absolute',
                                            top: '10px',
                                            right: '10px',
                                            background: '#dc3545',
                                            color: 'white',
                                            border: 'none',
                                            borderRadius: '50%',
                                            width: '25px',
                                            height: '25px',
                                            cursor: 'pointer',
                                            fontSize: '16px',
                                            display: 'flex',
                                            alignItems: 'center',
                                            justifyContent: 'center',
                                            opacity: '0.7',
                                            transition: 'opacity 0.3s'
                                        }}
                                        onMouseEnter={(e) => e.target.style.opacity = '1'}
                                        onMouseLeave={(e) => e.target.style.opacity = '0.7'}
                                        title="Remove from watchlist"
                                    >
                                        √ó
                                    </button>
                                    <div className="stock-header">
                                        <div>
                                            <div className="stock-symbol">{stock.symbol}</div>
                                            <div className="stock-name">{stock.name}</div>
                                        </div>
                                        <div className={`recommendation-badge badge-${getRecommendationClass(stock.recommendation?.type)}`}>
                                            {stock.recommendation?.action || 'Hold'}
                                        </div>
                                    </div>

                                    <div className="stock-price">${stock.price?.toFixed(2)}</div>
                                    <div className={`stock-change ${stock.change >= 0 ? 'positive' : 'negative'}`}>
                                        {stock.change >= 0 ? '‚ñ≤' : '‚ñº'} ${Math.abs(stock.change)?.toFixed(2)} 
                                        ({stock.changePercent >= 0 ? '+' : ''}{stock.changePercent?.toFixed(2)}%)
                                    </div>

                                    {stock.recommendation && (
                                        <>
                                            <div className="confidence-bar">
                                                <div className="confidence-label">
                                                    <span>Confidence</span>
                                                    <span><strong>{stock.recommendation.confidence}%</strong></span>
                                                </div>
                                                <div className="confidence-progress">
                                                    <div 
                                                        className={`confidence-fill ${getConfidenceClass(stock.recommendation.confidence)}`}
                                                        style={{width: `${stock.recommendation.confidence}%`}}
                                                    ></div>
                                                </div>
                                            </div>

                                            <div className="signals-summary">
                                                {stock.recommendation.bullishSignals?.slice(0, 2).map((signal, idx) => (
                                                    <div key={idx} className="signal-item bullish">{signal}</div>
                                                ))}
                                                {stock.recommendation.bearishSignals?.slice(0, 2).map((signal, idx) => (
                                                    <div key={idx} className="signal-item bearish">{signal}</div>
                                                ))}
                                            </div>
                                        </>
                                    )}
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* Penny Stocks Section */}
                    <div style={{marginBottom: '50px'}}>
                        <h2 style={{color: 'white', marginBottom: '20px', fontSize: '2em', display: 'flex', alignItems: 'center', gap: '10px'}}>
                            üöÄ Penny Stocks - High Upswing Potential
                            <span style={{fontSize: '0.5em', background: 'rgba(255,100,100,0.3)', padding: '5px 15px', borderRadius: '20px'}}>
                                ‚ö†Ô∏è High Risk ‚Ä¢ {pennyWatchlist.length} stocks
                            </span>
                        </h2>

                        <div className="summary-cards">
                            <div className="summary-card total">
                                <h3>Total Penny Stocks</h3>
                                <div className="value">{pennySummary.total}</div>
                            </div>
                            <div className="summary-card buy">
                                <h3>Buy Signals</h3>
                                <div className="value">{pennySummary.strongBuy + pennySummary.buy}</div>
                                <small>Strong: {pennySummary.strongBuy} | Buy: {pennySummary.buy}</small>
                            </div>
                            <div className="summary-card hold">
                                <h3>Hold Signals</h3>
                                <div className="value">{pennySummary.hold}</div>
                            </div>
                            <div className="summary-card sell">
                                <h3>Sell Signals</h3>
                                <div className="value">{pennySummary.strongSell + pennySummary.sell}</div>
                                <small>Strong: {pennySummary.strongSell} | Sell: {pennySummary.sell}</small>
                            </div>
                        </div>

                        <div className="filters">
                            <strong>Filter:</strong>
                            <button 
                                className={`filter-btn ${pennyFilter === 'all' ? 'active' : ''}`}
                                onClick={() => setPennyFilter('all')}
                            >
                                All ({pennyStocks.length})
                            </button>
                            <button 
                                className={`filter-btn ${pennyFilter === 'buy' ? 'active' : ''}`}
                                onClick={() => setPennyFilter('buy')}
                            >
                                Buy ({pennySummary.strongBuy + pennySummary.buy})
                            </button>
                            <button 
                                className={`filter-btn ${pennyFilter === 'hold' ? 'active' : ''}`}
                                onClick={() => setPennyFilter('hold')}
                            >
                                Hold ({pennySummary.hold})
                            </button>
                            <button 
                                className={`filter-btn ${pennyFilter === 'sell' ? 'active' : ''}`}
                                onClick={() => setPennyFilter('sell')}
                            >
                                Sell ({pennySummary.strongSell + pennySummary.sell})
                            </button>
                            
                            <div style={{marginLeft: 'auto', display: 'flex', gap: '10px', alignItems: 'center'}}>
                                <form onSubmit={addPennyStock} style={{display: 'flex', gap: '10px'}}>
                                    <input
                                        type="text"
                                        placeholder="Add penny stock (e.g., SAVA)"
                                        value={customPennySymbol}
                                        onChange={(e) => setCustomPennySymbol(e.target.value.toUpperCase())}
                                        style={{
                                            padding: '10px 15px',
                                            border: '2px solid #e0e0e0',
                                            borderRadius: '25px',
                                            fontSize: '14px',
                                            minWidth: '200px'
                                        }}
                                    />
                                    <button
                                        type="submit"
                                        className="filter-btn"
                                        style={{background: '#ff6b6b', color: 'white', border: 'none'}}
                                    >
                                        + Add Penny Stock
                                    </button>
                                </form>
                            </div>
                        </div>

                        <div className="stocks-grid">
                            {filteredPennyStocks.map(stock => (
                                <div 
                                    key={stock.symbol} 
                                    className={`stock-card ${getRecommendationClass(stock.recommendation?.type)} ${loading ? 'updating' : ''}`}
                                    onClick={() => handleStockClick(stock.symbol)}
                                    style={{
                                        animationDelay: `${filteredPennyStocks.indexOf(stock) * 0.05}s`,
                                        border: '2px solid rgba(255, 107, 107, 0.3)'
                                    }}
                                >
                                    <button
                                        onClick={(e) => {
                                            e.stopPropagation();
                                            removePennyStock(stock.symbol);
                                        }}
                                        style={{
                                            position: 'absolute',
                                            top: '10px',
                                            right: '10px',
                                            background: '#dc3545',
                                            color: 'white',
                                            border: 'none',
                                            borderRadius: '50%',
                                            width: '25px',
                                            height: '25px',
                                            cursor: 'pointer',
                                            fontSize: '16px',
                                            display: 'flex',
                                            alignItems: 'center',
                                            justifyContent: 'center',
                                            opacity: '0.7',
                                            transition: 'opacity 0.3s'
                                        }}
                                        onMouseEnter={(e) => e.target.style.opacity = '1'}
                                        onMouseLeave={(e) => e.target.style.opacity = '0.7'}
                                        title="Remove from penny watchlist"
                                    >
                                        √ó
                                    </button>
                                    <div className="stock-header">
                                        <div>
                                            <div className="stock-symbol">{stock.symbol}</div>
                                            <div className="stock-name">{stock.name}</div>
                                        </div>
                                        <div className={`recommendation-badge badge-${getRecommendationClass(stock.recommendation?.type)}`}>
                                            {stock.recommendation?.action || 'Hold'}
                                        </div>
                                    </div>

                                    <div className="stock-price">${stock.price?.toFixed(2)}</div>
                                    <div className={`stock-change ${stock.change >= 0 ? 'positive' : 'negative'}`}>
                                        {stock.change >= 0 ? '‚ñ≤' : '‚ñº'} ${Math.abs(stock.change)?.toFixed(2)} 
                                        ({stock.changePercent >= 0 ? '+' : ''}{stock.changePercent?.toFixed(2)}%)
                                    </div>

                                    {stock.recommendation && (
                                        <>
                                            <div className="confidence-bar">
                                                <div className="confidence-label">
                                                    <span>Confidence</span>
                                                    <span><strong>{stock.recommendation.confidence}%</strong></span>
                                                </div>
                                                <div className="confidence-progress">
                                                    <div 
                                                        className={`confidence-fill ${getConfidenceClass(stock.recommendation.confidence)}`}
                                                        style={{width: `${stock.recommendation.confidence}%`}}
                                                    ></div>
                                                </div>
                                            </div>

                                            <div className="signals-summary">
                                                {stock.recommendation.bullishSignals?.slice(0, 2).map((signal, idx) => (
                                                    <div key={idx} className="signal-item bullish">{signal}</div>
                                                ))}
                                                {stock.recommendation.bearishSignals?.slice(0, 2).map((signal, idx) => (
                                                    <div key={idx} className="signal-item bearish">{signal}</div>
                                                ))}
                                            </div>
                                        </>
                                    )}
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* Crypto Section */}
                    <div style={{marginBottom: '50px'}}>
                        <h2 style={{color: 'white', marginBottom: '20px', fontSize: '2em', display: 'flex', alignItems: 'center', gap: '10px'}}>
                            ‚Çø Cryptocurrency Market
                            <span style={{fontSize: '0.5em', background: 'rgba(255,193,7,0.3)', padding: '5px 15px', borderRadius: '20px'}}>
                                üî• {cryptoWatchlist.length} coins
                            </span>
                        </h2>

                        <div className="summary-cards">
                            <div className="summary-card total">
                                <h3>Total Cryptocurrencies</h3>
                                <div className="value">{cryptoSummary.total}</div>
                            </div>
                            <div className="summary-card buy">
                                <h3>Buy Signals</h3>
                                <div className="value">{cryptoSummary.strongBuy + cryptoSummary.buy}</div>
                                <small>Strong: {cryptoSummary.strongBuy} | Buy: {cryptoSummary.buy}</small>
                            </div>
                            <div className="summary-card hold">
                                <h3>Hold Signals</h3>
                                <div className="value">{cryptoSummary.hold}</div>
                            </div>
                            <div className="summary-card sell">
                                <h3>Sell Signals</h3>
                                <div className="value">{cryptoSummary.strongSell + cryptoSummary.sell}</div>
                                <small>Strong: {cryptoSummary.strongSell} | Sell: {cryptoSummary.sell}</small>
                            </div>
                        </div>

                        <div className="filters">
                            <strong>Filter:</strong>
                            <button 
                                className={`filter-btn ${cryptoFilter === 'all' ? 'active' : ''}`}
                                onClick={() => setCryptoFilter('all')}
                            >
                                All ({cryptoStocks.length})
                            </button>
                            <button 
                                className={`filter-btn ${cryptoFilter === 'buy' ? 'active' : ''}`}
                                onClick={() => setCryptoFilter('buy')}
                            >
                                Buy ({cryptoSummary.strongBuy + cryptoSummary.buy})
                            </button>
                            <button 
                                className={`filter-btn ${cryptoFilter === 'hold' ? 'active' : ''}`}
                                onClick={() => setCryptoFilter('hold')}
                            >
                                Hold ({cryptoSummary.hold})
                            </button>
                            <button 
                                className={`filter-btn ${cryptoFilter === 'sell' ? 'active' : ''}`}
                                onClick={() => setCryptoFilter('sell')}
                            >
                                Sell ({cryptoSummary.strongSell + cryptoSummary.sell})
                            </button>

                            <div style={{marginLeft: 'auto', display: 'flex', gap: '10px'}}>
                                <form onSubmit={addCrypto} style={{display: 'flex', gap: '10px'}}>
                                    <input
                                        type="text"
                                        placeholder="Add Crypto (e.g., BTC-USD)"
                                        value={customCryptoSymbol}
                                        onChange={(e) => setCustomCryptoSymbol(e.target.value.toUpperCase())}
                                        style={{
                                            padding: '10px 15px',
                                            border: '2px solid #e0e0e0',
                                            borderRadius: '25px',
                                            fontSize: '14px',
                                            minWidth: '200px'
                                        }}
                                    />
                                    <button
                                        type="submit"
                                        className="filter-btn"
                                        style={{background: '#ffc107', color: '#333', border: 'none'}}
                                    >
                                        + Add Crypto
                                    </button>
                                </form>
                            </div>
                        </div>

                        <div className="stocks-grid">
                            {filteredCryptoStocks.map(stock => (
                                <div 
                                    key={stock.symbol} 
                                    className={`stock-card ${getRecommendationClass(stock.recommendation?.type)} ${loading ? 'updating' : ''}`}
                                    onClick={() => handleStockClick(stock.symbol)}
                                    style={{
                                        animationDelay: `${filteredCryptoStocks.indexOf(stock) * 0.05}s`,
                                        border: '2px solid rgba(255, 193, 7, 0.4)',
                                        background: 'linear-gradient(135deg, rgba(255,215,0,0.05), rgba(255,193,7,0.05))'
                                    }}
                                >
                                    <button
                                        onClick={(e) => {
                                            e.stopPropagation();
                                            removeCrypto(stock.symbol);
                                        }}
                                        style={{
                                            position: 'absolute',
                                            top: '10px',
                                            right: '10px',
                                            background: '#dc3545',
                                            color: 'white',
                                            border: 'none',
                                            borderRadius: '50%',
                                            width: '25px',
                                            height: '25px',
                                            cursor: 'pointer',
                                            fontSize: '16px',
                                            display: 'flex',
                                            alignItems: 'center',
                                            justifyContent: 'center',
                                            opacity: '0.7',
                                            transition: 'opacity 0.3s'
                                        }}
                                        onMouseEnter={(e) => e.target.style.opacity = '1'}
                                        onMouseLeave={(e) => e.target.style.opacity = '0.7'}
                                        title="Remove from crypto watchlist"
                                    >
                                        √ó
                                    </button>
                                    <div className="stock-header">
                                        <div>
                                            <div className="stock-symbol">{stock.symbol}</div>
                                            <div className="stock-name">{stock.name}</div>
                                        </div>
                                        <div className={`recommendation-badge badge-${getRecommendationClass(stock.recommendation?.type)}`}>
                                            {stock.recommendation?.action || 'Hold'}
                                        </div>
                                    </div>

                                    <div className="stock-price">${stock.price?.toFixed(2)}</div>
                                    <div className={`stock-change ${stock.change >= 0 ? 'positive' : 'negative'}`}>
                                        {stock.change >= 0 ? '‚ñ≤' : '‚ñº'} {stock.changePercent?.toFixed(2)}%
                                    </div>

                                    {stock.recommendation && (
                                        <>
                                            <div className="stock-info">
                                                <div className="info-row">
                                                    <span className="info-label">Confidence</span>
                                                    <span className="info-value">{stock.recommendation.confidence}%</span>
                                                </div>
                                                <div className="confidence-bar">
                                                    <div 
                                                        className={`confidence-fill ${getConfidenceClass(stock.recommendation.confidence)}`}
                                                        style={{width: `${stock.recommendation.confidence}%`}}
                                                    ></div>
                                                </div>
                                            </div>

                                            <div className="signals-summary">
                                                {stock.recommendation.bullishSignals?.slice(0, 2).map((signal, idx) => (
                                                    <div key={idx} className="signal-item bullish">{signal}</div>
                                                ))}
                                                {stock.recommendation.bearishSignals?.slice(0, 2).map((signal, idx) => (
                                                    <div key={idx} className="signal-item bearish">{signal}</div>
                                                ))}
                                            </div>
                                        </>
                                    )}
                                </div>
                            ))}
                        </div>
                    </div>

                    <button className="refresh-btn" onClick={fetchAllStocks} title="Refresh data">
                        üîÑ
                    </button>
                </div>
            );
        }

        ReactDOM.render(<Dashboard />, document.getElementById('root'));
    </script>
</body>
</html>
